---
name: Test Action

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    name: ${{ matrix.image }}, version ${{ matrix.tag }}, cache = ${{ matrix.cache }}
    container:
      image: ${{ matrix.image }}:${{ matrix.tag }}
    strategy:
      fail-fast: false
      matrix:
        image: ["rocker/verse"]
        tag: ["4.2.1", "4.1.3"]
        cache: [true, false]
        test-packages: [BiocGenerics]
    steps:

      - name: Checkout This Repo
        uses: actions/checkout@v3

      - name: Checkout Test Repo - ${{ matrix.test-packages }}
        uses: actions/checkout@v3
        with:
          repository: "Bioconductor/${{ matrix.test-packages }}"
          path: "${{ matrix.test-packages }}"

      - name: Run R CMD Check
        run: |
          R CMD build ${{ matrix.test-packages }}
          R CMD INSTALL ${{ matrix.test-packages }}_*.tar.gz
          R CMD check ${{ matrix.test-packages }}_*.tar.gz
        env:
          _R_CHECK_FORCE_SUGGESTS_: 0

      - name: Test BiocCheck Action
        uses: ./
        with:
          path: "${{ matrix.test-packages }}"
          no-check-bioc-help: true
          no-check-man-doc: true
          no-check-vignettes: true
          no-check-bioc-views: true
          no-cache: ${{ matrix.cache }}
